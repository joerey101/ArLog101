generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}

// Enums
enum Rol {
  admin
  empresa
  candidato
}



enum Modalidad {
  remoto
  hibrido
  presencial
}

enum EstadoAnuncio {
  activo
  pausado
  cerrado
  borrador
}

enum EstadoPostulacion {
  nuevo
  visto
  entrevista
  finalista
  descartado
  contratado
}

enum TipoEtiqueta {
  hard_skill
  soft_skill
  idioma
  certificacion
  documentacion
}

enum EstadoEtiqueta {
  aprobada
  sugerida
}

enum NivelEtiqueta {
  basico
  intermedio
  avanzado
  experto
}

// Modelos

model Usuario {
  id              Int       @id @default(autoincrement())
  email           String    @unique
  password_hash   String
  rol             Rol
  fecha_registro  DateTime  @default(now())

  // Relaciones
  perfilCandidato PerfilCandidato?
  perfilEmpresa   PerfilEmpresa?
  anuncios        Anuncio[]
  postulaciones   Postulacion[]

  @@map("usuarios")
}

model PerfilCandidato {
  id              Int      @id @default(autoincrement())
  usuario_id      Int      @unique
  nombre          String?
  apellido        String?
  telefono        String?
  ubicacion       String?  // Nuevo
  zona            String?  // Nuevo
  localidad       String?  // Nuevo
  cv_url          String?
  linkedin_url    String?  // Usamos este como can√≥nico
  licencias       String?  // Nuevo (JSON o texto)
  
  // Campos legacy que tengo que mantener para que compile por ahora o eliminar si no se usan
  // Eliminados: direccion, ciudad, provincia, codigo_postal, fecha_nacimiento, genero, resumen, titulo

  usuario         Usuario  @relation(fields: [usuario_id], references: [id])
  etiquetas       PerfilEtiqueta[]

  @@map("perfiles_candidatos")
}

model PerfilEmpresa {
  id              Int      @id @default(autoincrement())
  usuario_id      Int      @unique
  razon_social    String?
  cuit            String?
  rubro           String?  @map("industria") // Mapeado a industria
  sitio_web       String?
  logo_url        String?
  descripcion     String?  @db.Text
  
  // Eliminados: telefono, direccion, ciudad

  usuario         Usuario  @relation(fields: [usuario_id], references: [id])
  anuncios        Anuncio[]

  @@map("perfiles_empresas")
}

model Etiqueta {
  id              Int      @id @default(autoincrement())
  nombre          String   @unique
  categoria       TipoEtiqueta?

  match_perfiles  PerfilEtiqueta[]
  match_anuncios  AnuncioEtiqueta[]

  @@map("etiquetas")
}

model Anuncio {
  id                Int      @id @default(autoincrement())
  usuario_id        Int
  titulo            String
  descripcion       String   @db.Text
  departamento      String?  // Nuevo
  ubicacion         String?
  tipo_contrato     String?
  fecha_publicacion DateTime @default(now()) @map("fecha_creacion") // Mapeado
  estado            EstadoAnuncio @default(activo)
  requisitos_json   String?  // Nuevo (posiblemente JSON string)

  // Eliminados: modalidad, salario_min, salario_max
  
  usuario         Usuario       @relation(fields: [usuario_id], references: [id])
  empresa_perfil  PerfilEmpresa? @relation(fields: [usuario_id], references: [usuario_id])
  postulaciones   Postulacion[]
  etiquetas       AnuncioEtiqueta[]

  @@map("anuncios")
}

model AnuncioEtiqueta {
  anuncio_id      Int
  etiqueta_id     Int
  estado          EstadoEtiqueta @default(sugerida)

  anuncio         Anuncio  @relation(fields: [anuncio_id], references: [id])
  etiqueta        Etiqueta        @relation(fields: [etiqueta_id], references: [id])

  @@id([anuncio_id, etiqueta_id])
  @@map("anuncio_etiquetas")
}

model PerfilEtiqueta {
  candidato_id    Int
  etiqueta_id     Int
  nivel           NivelEtiqueta? @default(basico)

  perfil          PerfilCandidato @relation(fields: [candidato_id], references: [id])
  etiqueta        Etiqueta        @relation(fields: [etiqueta_id], references: [id])

  @@id([candidato_id, etiqueta_id])
  @@map("perfil_etiquetas")
}

model Postulacion {
  estado            EstadoPostulacion @default(nuevo)
  fecha_postulacion DateTime  @default(now())
  mensaje_candidato String?   @db.Text
  cv_snapshot_url   String?   @db.VarChar(255)
  match_score       Int?      @default(0)

  anuncio Anuncio @relation(fields: [anuncio_id], references: [id], onDelete: Cascade)
  usuario Usuario @relation(fields: [usuario_id], references: [id], onDelete: Cascade)

  @@map("postulaciones")
}
